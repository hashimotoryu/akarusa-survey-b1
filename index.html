<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>明るさ印象調査</title>

  <!-- ✅ 非モジュール形式でCDN読み込み（CORS対策済み） -->
  <script src="https://unpkg.com/jspsych@6.3.1/jspsych.js"></script>
  <script src="https://unpkg.com/jspsych@6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="https://unpkg.com/jspsych@6.3.1/plugins/jspsych-survey-html-form.js"></script>
  <link href="https://unpkg.com/jspsych@6.3.1/css/jspsych.css" rel="stylesheet" />
</head>
<body></body>

<script>
// === jsPsych初期化 ===
var jsPsych = initJsPsych({
  on_finish: function(){
    jsPsych.data.get().localSave('csv', 'brightness_survey_results.csv');
  }
});

// === 1. 被験者情報 ===
var participant_info = {
  type: 'survey-html-form',
  preamble: '<h3>参加者情報</h3><p>以下の項目を入力してください。</p>',
  html: `
    <p>ID: <input name="ID" type="text" required></p>
    <p>性別: <input name="sex" type="text" required></p>
    <p>年齢: <input name="age" type="number" required></p>
  `,
  button_label: '次へ'
};

// === 2. 説明 ===
var instruction = {
  type: 'html-keyboard-response',
  stimulus: `
  <p>以下の単語から感じる「明るさ」「暗さ」を、a〜g のいずれかで答えてください。</p>
  <p>
    a: とても暗い<br>
    b: まあまあ暗い<br>
    c: どちらかというと暗い<br>
    d: 明るくも暗くもない<br>
    e: まあまあ明るい<br>
    f: どちらかというと明るい<br>
    g: とても明るい
  </p>
  <p>スペースキーを押すと開始します。</p>`,
  choices: [' ']
};

// === 3. 単語リスト ===
var words = ['太陽', '青空', 'ろうそく', 'カラス', '火花'];

var trials = words.map(function(word){
  return {
    type: 'html-keyboard-response',
    stimulus: '<h2>' + word + '</h2><p>a〜g のキーで答えてください。</p>',
    choices: ['a','b','c','d','e','f','g'],
    data: {word: word},
    on_finish: function(data){
      data.response = jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press);
    }
  };
});

// === 4. 終了メッセージ ===
var ending = {
  type: 'html-keyboard-response',
  stim
